<script>


    window.external.addEventListener(
        'incident_last_update',
        function () {
            alert('@@@@@@');
        }
    );

    function setAge() {
        var createdTime = window.external.Incident.Created;
        var updatedTime = window.external.Incident.Updated;

        alert(window.event);

        var lastSavedChange = null;
        if (typeof createdTime !== 'undefined') {
            lastSavedChange = createdTime;
        }

        if (typeof updatedTime !== 'undefined') {
            lastSavedChange = updatedTime;
        }

        var lastSavedChangeMessage = computeLastSaved(lastSavedChange);
        window.external.Incident.SetCustomFieldByName("c$age_test", lastSavedChangeMessage);
    }

    function computeLastSaved(lastSavedChange) {
        if (null === lastSavedChange) {
            return "N/A";
        }

        var nowTimestamp = Date.now() / 1000 | 0;
        var secondsDiff = nowTimestamp - lastSavedChange;

        var daysDiff = secondsDiff / 86400 | 0;  ///  number of days
        var hoursDiff = secondsDiff % 86400 / (60 * 60) | 0;  ////  number of hours

        if (daysDiff === 0 && hoursDiff === 0) {
            return 'A few moments ago';
        }

        var output = '';
        if (daysDiff > 0) {
            output += daysDiff + ' ' + pluralize('day', daysDiff);
        }

        if (daysDiff > 0 && hoursDiff > 0) {
            output += ' and ';
        }

        if (hoursDiff > 0) {
            output += hoursDiff + ' ' + pluralize('hour', hoursDiff);
        }

        output += ' ago';
        return output;
    }

    function pluralize(baseString, count) {
        if (count > 1) {
            return baseString + 's';
        }

        return baseString;
    }

    function ondataupdated(obj) {
        setAge();
    }

    setAge();
</script>
